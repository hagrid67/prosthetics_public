import numpy as np


dObsDummy = {'body_acc': {'calcn_l': [11.735988730539892,
   3.8646818559506966,
   -3.554636800473133],
  'femur_l': [-1.4486122792262242, -0.9173455764907529, -0.7206449214747431],
  'femur_r': [-2.89938721107141, -3.7999610390688185, -2.6537856568824743],
  'head': [1.2932092808328493, -6.250152284759729, 3.2446305160533155],
  'pelvis': [-1.7281260003156915, -3.797517222775605, 0.10323421100727076],
  'pros_foot_r': [-27.142644429549524, 0.9962187679283789, 13.231117159763986],
  'pros_tibia_r': [-26.44390127566169, -1.1657850978839521, 4.167024123349941],
  'talus_l': [12.63323736624061, -3.119716054418591, -2.2474375540933176],
  'tibia_l': [10.913789959840319, -3.138473402652296, -2.336066429989479],
  'toes_l': [1.0435930526558785, -12.411996022951623, 0.52931302727931],
  'torso': [-1.4952027664892662, -2.6607064595996386, -1.2882042873399215]},
 'body_acc_rot': {'calcn_l': [-8.712802256087837,
   -21.35508694151348,
   -109.26479665201344],
  'femur_l': [1.537930057814039, -15.336028595141213, 32.38443742205171],
  'femur_r': [-14.59911426556542, 5.452798562900193, -62.84003416827574],
  'head': [18.98354656039567, -9.729194349892166, -8.88452602607242],
  'pelvis': [18.98354656039569, -9.729194349892406, -8.884526026071478],
  'pros_foot_r': [-12.60204412809591, -53.81354375830386, 70.1781514705712],
  'pros_tibia_r': [-13.960617530800379,
   -20.138725734575445,
   -10.128963172533739],
  'talus_l': [-8.712802256087837, -21.35508694151348, -109.26479665201344],
  'tibia_l': [-0.4660137663100706, -16.4885287820621, 4.681521902159729],
  'toes_l': [-8.712802256087837, -21.35508694151348, -109.26479665201344],
  'torso': [18.98354656039567, -9.729194349892166, -8.88452602607242]},
 'body_pos': {'calcn_l': [-0.08132961895378363,
   0.10057770126239596,
   -0.0832670846950071],
  'femur_l': [0.05576115135224008, 0.9285667480544683, -0.11853261553828891],
  'femur_r': [0.05968359949837958, 0.8867590096342253, 0.043101933394559575],
  'head': [-0.3002889004017695, 1.4830486256831081, 0.11979960624495802],
  'pelvis': [0.08190008373938687, 0.9985358602629871, -0.014797233192573042],
  'pros_foot_r': [0.07716845667096496,
   0.12929231615864256,
   -0.27613279453342016],
  'pros_tibia_r': [0.03227304155990168,
   0.5231579692340553,
   -0.10953672906522276],
  'talus_l': [-0.01723779245021171, 0.10977624543073539, -0.08032321638627737],
  'tibia_l': [-0.010592519761361704, 0.5393579931249088, -0.09808166223354363],
  'toes_l': [0.06776883610836917, 0.002181685449414758, -0.09117158785527946],
  'torso': [-0.046772551559547904, 1.012038903318521, -0.008182042079103545]},
 'body_pos_rot': {'calcn_l': [-0.040198983291653334,
   0.07210662625138053,
   -0.5688552171972534],
  'femur_l': [-0.040198983291653334,
   0.07210662625138053,
   -0.15620920335867214],
  'femur_r': [0.3985311849501512, 0.015473979520761474, -0.05639805974683398],
  'head': [0.25310870525681584, 0.023489873574553365, 0.479196146426924],
  'pelvis': [0.25310870525681584, 0.023489873574553365, 0.5664626464269239],
  'pros_foot_r': [0.3985311849501512,
   0.015473979520761473,
   0.10271363904778408],
  'pros_tibia_r': [0.3985311849501512,
   0.015473979520761473,
   0.10461114076337134],
  'talus_l': [-0.040198983291653334, 0.07210662625138053, -0.5688552171972534],
  'tibia_l': [-0.040198983291653334,
   0.07210662625138053,
   -0.015495005608387447],
  'toes_l': [-0.040198983291653334, 0.07210662625138053, -0.5688552171972534],
  'torso': [0.25310870525681584, 0.023489873574553365, 0.479196146426924]},
 'body_vel': {'calcn_l': [0.13043276044161067,
   0.24547692283819536,
   -0.04937342873833912],
  'femur_l': [-0.03284019379639136, 0.2018133578324321, -0.27419070430395337],
  'femur_r': [-0.10133970688858768, -0.22384669080425995, -0.3826279059847184],
  'head': [-0.7412506946202193, -0.7825401208971465, 0.9576048433490528],
  'pelvis': [-0.17223321409963954, -0.04808366033880832, -0.07051229911400828],
  'pros_foot_r': [1.5097958981489032, 0.6667084069737571, -2.2828903686079234],
  'pros_tibia_r': [0.41557129787034686,
   0.13730214814487404,
   -1.3261494409415806],
  'talus_l': [0.13813999342468417, 0.19228029114721407, -0.05094927129339541],
  'tibia_l': [0.07597689970952949, 0.18834531376030464, -0.169399117074757],
  'toes_l': [0.047394196638098615, 0.11660382761659666, -0.011461173466588204],
  'torso': [-0.1900354398125108, -0.1925142103220516, -0.1219707310571626]},
 'body_vel_rot': {'calcn_l': [-0.3470782509374511,
   -0.025225869728829637,
   -0.8459484978407306],
  'femur_l': [-0.2658476508221752, 0.01996898364010502, 0.27772435940570683],
  'femur_r': [2.5457049517500034, -0.7101475614965274, 1.131743626855314],
  'head': [2.6573958367581993, -0.6787873904935865, 0.9858457345203678],
  'pelvis': [2.6573958367581993, -0.6787873904935862, 0.9858457345203666],
  'pros_foot_r': [2.564101715238906, -1.171474991752848, 2.2273695014524884],
  'pros_tibia_r': [2.564889757697097, -1.1912363808900963, 2.2743016538387515],
  'talus_l': [-0.3470782509374511, -0.025225869728829637, -0.8459484978407306],
  'tibia_l': [-0.27550719061191387, 0.014594635995386209, 0.14410276040461686],
  'toes_l': [-0.3470782509374511, -0.025225869728829637, -0.8459484978407306],
  'torso': [2.6573958367581993, -0.6787873904935865, 0.9858457345203678]},
 'forces': {'AnkleLimit_l': [0.0, 0.0],
  'AnkleLimit_r': [0.0, 0.0],
  'HipAddLimit_l': [0.0, 0.0],
  'HipAddLimit_r': [0.0, 0.0],
  'HipLimit_l': [257.6071283020964, 21.054900534335395],
  'HipLimit_r': [64.78393994187, 1.5817900420067323],
  'KneeLimit_l': [-150.84277234191669, 6.43969095422934],
  'KneeLimit_r': [-201.42765584751433, 9.869365660021467],
  'abd_l': [2998.6291118335544],
  'abd_r': [2672.7742804346053],
  'add_l': [957.4275823620665],
  'add_r': [1118.0244632851227],
  'ankleSpring': [0.4778668604633012],
  'bifemsh_l': [359.0559210462692],
  'bifemsh_r': [293.42129434211114],
  'foot_l': [109.49481609344008,
   -462.8899773169853,
   -13.979113788710634,
   -42.783953383328054,
   -9.059087665129798,
   -35.78363052908762,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   -109.49481609344008,
   462.8899773169853,
   13.979113788710634,
   0.5510411198956673,
   0.023619691256435926,
   4.17523227302872,
   -109.49481609344008,
   462.8899773169853,
   13.979113788710634,
   0.5510411198956673,
   0.023619691256435926,
   4.17523227302872],
  'gastroc_l': [979.5412049007106],
  'glut_max_l': [1753.2818146834875],
  'glut_max_r': [2035.9349428205958],
  'hamstrings_l': [1245.1898898778784],
  'hamstrings_r': [1469.9239780555765],
  'iliopsoas_l': [1172.55049696229],
  'iliopsoas_r': [1294.1247480633594],
  'pros_foot_r_0': [0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0,
   0.0],
  'rect_fem_l': [1683.839208092017],
  'rect_fem_r': [1027.8389048153783],
  'soleus_l': [898.3907074973922],
  'tib_ant_l': [1590.5894201890774],
  'vasti_l': [4600.641495621289],
  'vasti_r': [5123.994743350346]},
 'joint_acc': {'ankle_l': [-114.34761067167096],
  'ankle_r': [87.09222178753046],
  'back': [-9.727774141765622e-13],
  'back_0': [],
  'ground_pelvis': [-0.07084392409542994,
   7.548762328845458,
   -22.681600360924808,
   -1.7281260003156915,
   -3.797517222775605,
   0.10323421100727076],
  'hip_l': [40.814758137507646, 18.93885196954911, 1.0818013151947525e-12],
  'hip_r': [-56.78051779116613, -32.23510028325521, 1.1315393066979595e-12],
  'knee_l': [-27.799174666661344],
  'knee_r': [58.514259928289405],
  'mtp_l': [],
  'subtalar_l': []},
 'joint_pos': {'ankle_l': [-0.5533602115888661],
  'ankle_r': [-0.0018975017155872561],
  'back': [-0.0872665],
  'back_0': [],
  'ground_pelvis': [0.5828752411776248,
   0.22540821004454936,
   -0.11846436470853854,
   0.08190008373938687,
   0.9985358602629871,
   -0.014797233192573042],
  'hip_l': [-0.7367913848779252, 0.2969480169695683, -9.235396808168638e-16],
  'hip_r': [-0.6200227513513729, 0.14561524346708776, 8.062883218764018e-16],
  'knee_l': [0.1407141977502847],
  'knee_r': [0.16100920051020534],
  'mtp_l': [],
  'subtalar_l': []},
 'joint_vel': {'ankle_l': [-0.9934332304213755],
  'ankle_r': [-0.05092897445616856],
  'back': [1.2375108042944733e-15],
  'back_0': [],
  'ground_pelvis': [1.4511996049267901,
   1.8449932166055145,
   -2.0820805003877196,
   -0.17223321409963954,
   -0.04808366033880832,
   -0.07051229911400828],
  'hip_l': [-0.9289615195461001, 2.944839441322805, -1.0069632391441463e-14],
  'hip_r': [0.14643794095255333, -0.11532752731505186, 3.4898155295747744e-15],
  'knee_l': [-0.13407804459032036],
  'knee_r': [1.2398602154876217],
  'mtp_l': [],
  'subtalar_l': []},
 'markers': {},
 'misc': {'mass_center_acc': [-1.5171738506301469,
   -3.392788646921878,
   0.19369634702263575],
  'mass_center_pos': [-0.08890221296030965,
   0.9820057331358497,
   -0.003584043903212306],
  'mass_center_vel': [-0.19938090248949555,
   -0.23308804705562458,
   -0.015512190240887553]},
 'muscles': {'abd_l': {'activation': 0.5823580315067581,
   'fiber_force': 2998.6291118335544,
   'fiber_length': 0.06845278923537738,
   'fiber_velocity': 0.058508071914179775},
  'abd_r': {'activation': 0.7067610653449832,
   'fiber_force': 2672.7742804346053,
   'fiber_length': 0.06718081885696359,
   'fiber_velocity': -0.014479987814874041},
  'add_l': {'activation': 0.742730599434042,
   'fiber_force': 969.7915895876179,
   'fiber_length': 0.0476374474485992,
   'fiber_velocity': -0.1622673399124503},
  'add_r': {'activation': 0.36767176320594397,
   'fiber_force': 1129.4020393336064,
   'fiber_length': 0.05355452764420067,
   'fiber_velocity': 0.007404560555701351},
  'bifemsh_l': {'activation': 0.7275656811919663,
   'fiber_force': 378.9868356647348,
   'fiber_length': 0.1343044640608333,
   'fiber_velocity': -0.0034475804846816316},
  'bifemsh_r': {'activation': 0.5237590481931168,
   'fiber_force': 309.53434468493487,
   'fiber_length': 0.13497333534582967,
   'fiber_velocity': 0.01563904822284504},
  'gastroc_l': {'activation': 0.5084086199899853,
   'fiber_force': 1175.4812532624442,
   'fiber_length': 0.026973277083001925,
   'fiber_velocity': -0.022019647610699366},
  'glut_max_l': {'activation': 0.703457297532706,
   'fiber_force': 1753.2818146834875,
   'fiber_length': 0.11535746046697398,
   'fiber_velocity': -0.05171507288351497},
  'glut_max_r': {'activation': 0.6921193548279323,
   'fiber_force': 2035.9349428205958,
   'fiber_length': 0.12312453095111288,
   'fiber_velocity': -0.008329689431461024},
  'hamstrings_l': {'activation': 0.403803277404044,
   'fiber_force': 1397.4667599992868,
   'fiber_length': 0.039341369167988846,
   'fiber_velocity': 0.04804046152757805},
  'hamstrings_r': {'activation': 0.4479376467092835,
   'fiber_force': 1638.4966461437502,
   'fiber_length': 0.040422894708022655,
   'fiber_velocity': 0.0772334377318422},
  'iliopsoas_l': {'activation': 0.3648583662040674,
   'fiber_force': 1179.4074813079494,
   'fiber_length': 0.15122503215737862,
   'fiber_velocity': 0.04250104953949114},
  'iliopsoas_r': {'activation': 0.4635713816250869,
   'fiber_force': 1301.99997937054,
   'fiber_length': 0.14827150864357214,
   'fiber_velocity': 0.010240659228433762},
  'rect_fem_l': {'activation': 0.7683924571121696,
   'fiber_force': 1692.2134420467257,
   'fiber_length': 0.0666634180961034,
   'fiber_velocity': 0.004079610268342095},
  'rect_fem_r': {'activation': 0.4685657644634965,
   'fiber_force': 1032.9309091903642,
   'fiber_length': 0.06679158273288302,
   'fiber_velocity': 0.002975729389754949},
  'soleus_l': {'activation': 0.48102977938804226,
   'fiber_force': 1861.638686433253,
   'fiber_length': 0.021230998596459636,
   'fiber_velocity': -0.010167513998360776},
  'tib_ant_l': {'activation': 0.5747972035116659,
   'fiber_force': 1595.0521721955918,
   'fiber_length': 0.07928298036402064,
   'fiber_velocity': 0.19036874711520702},
  'vasti_l': {'activation': 0.5045990566202175,
   'fiber_force': 4613.108061830156,
   'fiber_length': 0.0705240721287838,
   'fiber_velocity': 0.021281923897803753},
  'vasti_r': {'activation': 0.7822134585929917,
   'fiber_force': 5138.255035273073,
   'fiber_length': 0.06959299649135772,
   'fiber_velocity': -0.04789553828219679}},
 'target_vel': [1.25, 0.0, 0.0]}



def DictToListFull(state_desc, nObsVer=1, bRelPos=True, dEnvConfig={}, bDummy=False):
        """
        Return observation list of length 349 # 347
        given a dict-type observation.

        For more details about the observation, visit this page:
        http://osim-rl.stanford.edu/docs/nips2018/observation/
        """
        res = []

        if bDummy:
            state_desc = dObsDummy

        posPelvis = state_desc["body_pos"]["pelvis"].copy()
        posRel = posPelvis.copy() # relative position for other body parts



        if bRelPos:
            # subtract pelvis x,y,z from all other body coords
            # keep y coord for pelvis itself; x=z=0
            posPelvis[0] = posPelvis[2] = 0.
        else:
            # keep absolute coords for all bodies
            posRel = [0., 0., 0.]

        if nObsVer == 2:
            posRel[1] = 0. # ie keep absolute Y coords for all bodies

        lBodies = ['pelvis', # pelvis at position 0
                'calcn_l', 'talus_l', 'tibia_l', 'toes_l',
                'femur_l', 'femur_r', 'head', 
                'torso', 'pros_foot_r', 'pros_tibia_r' ]

        res += posPelvis

        # body_pos
        for body in lBodies[1:]: # skip pelvis - already done
            res += [ state_desc["body_pos"][body][i] - posRel[i] for i in range(3) ]

        # Other body attribs: rot, vel, acc.
        for info_type in [ 'body_pos_rot',
                          'body_vel', 'body_vel_rot',
                          'body_acc', 'body_acc_rot']:
            for body_part in lBodies: # all bodies incl pelvis
                res += state_desc[info_type][body_part]
        
        # Joint Observations
        # Neglecting `back_0`, `mtp_l`, `subtalar_l` since they do not move
        for info_type in ['joint_pos', 'joint_vel', 'joint_acc']:
            for joint in ['ankle_l', 'ankle_r', 'back', 'ground_pelvis',
                          'hip_l', 'hip_r', 'knee_l', 'knee_r']:
                res += state_desc[info_type][joint]


        lMuscInfo = ["activation", "fiber_force", "fiber_length", "fiber_velocity"]

        # Muscle Observations 19 x 4
        for muscle in ['abd_l', 'abd_r', 'add_l', 'add_r', 
                       'bifemsh_l', 'bifemsh_r', 'gastroc_l',
                       'glut_max_l', 'glut_max_r', 
                       'hamstrings_l', 'hamstrings_r',
                       'iliopsoas_l', 'iliopsoas_r', 'rect_fem_l', 'rect_fem_r',
                       'soleus_l', 'tib_ant_l', 'vasti_l', 'vasti_r']:
            for sInfo in lMuscInfo:
                if dEnvConfig[sInfo]:
                    res.append(state_desc['muscles'][muscle][sInfo])

            #res.append(state_desc['muscles'][muscle]['activation'])
            #res.append(state_desc['muscles'][muscle]['fiber_force'])
            #res.append(state_desc['muscles'][muscle]['fiber_length'])
            #res.append(state_desc['muscles'][muscle]['fiber_velocity'])

        # Force Observations
        # Neglecting forces corresponding to muscles as they are redundant with
        # `fiber_forces` in muscles dictionaries
        for force in ['AnkleLimit_l', 'AnkleLimit_r',
                      'HipAddLimit_l', 'HipAddLimit_r',
                      'HipLimit_l', 'HipLimit_r', 'KneeLimit_l', 'KneeLimit_r']:
            res += state_desc['forces'][force]

        # Center of Mass Observations - surely just a linear combination of bodies?
        res += [ state_desc['misc']['mass_center_pos'] [i] - posRel[i] for i in range(3) ]
        res += state_desc['misc']['mass_center_vel']
        res += state_desc['misc']['mass_center_acc']

        # round 2
        # Add the target vel x and z coords to the observation list (jw)
        res += [ state_desc["target_vel"][i] for i in [0,2] ]

        return res

